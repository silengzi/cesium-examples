<!--********************************************************************
* by jiawanlong
*********************************************************************-->
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" href="./../../libs/cesium/Cesium1.98/Widgets/widgets.css">
    <script type="text/javascript" src="./../../libs/cesium/Cesium1.98/Cesium.js"></script>
    <script src="./latlng.js"></script>
</head>

<body style="margin: 0; overflow: hidden; background: #fff; width: 100%; height: 100%; position: absolute; top: 0">
    <div id="map" style="margin: 0 auto; width: 100%; height: 100%"></div>
    <script type="text/javascript">

        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiIwNDljNWFmZC03MzRlLTRiMDMtYWIwMi00Yjk4YWQ4NzQwZGEiLCJpZCI6MjU5LCJpYXQiOjE3NTEzNzkyMzR9.OTqPNs3UGNnT1LYkPTavV80wN8Es_YphpJgQcpdnqWc'
        const viewer = new Cesium.Viewer('map', {});
        
        // 开启帧率
        viewer.scene.debugShowFramesPerSecond = true;
        // viewer.scene.globe.depthTestAgainstTerrain = true

        var handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas)
        handler.setInputAction((movement) => {
            // 1. 屏幕坐标
            console.log("movement.position: ", movement.position)

            // 2. 椭球面坐标（不包含地形、模型、倾斜摄影表面）
            var ellipsoidPosition = viewer.scene.camera.pickEllipsoid(movement.position, viewer.scene.globe.ellipsoid)
            console.log('ellipsoidPosition: ', ellipsoidPosition)
            // 椭球坐标转经纬度坐标
            var cartesian3 = new Cesium.Cartesian3(ellipsoidPosition.x, ellipsoidPosition.y, ellipsoidPosition.z)
            var cartographic = viewer.scene.globe.ellipsoid.cartesianToCartographic(cartesian3);
            var lat = Cesium.Math.toDegrees(cartographic.latitude);
            var lng = Cesium.Math.toDegrees(cartographic.longitude);
            console.log(lng, lat)

            // 3. 场景坐标（包含地形、模型、倾斜摄影表面）
            var scenePosition = viewer.scene.pickPosition(movement.position)
            console.log('scenePosition: ', scenePosition)

            // 4. 地表坐标（表示地球表面的世界坐标，包含地形，不包括模型、倾斜摄影表面）
            var ray = viewer.camera.getPickRay(movement.position)
            var position = viewer.scene.globe.pick(ray, viewer.scene)
            console.log('position: ', position)
        }, Cesium.ScreenSpaceEventType.LEFT_CLICK)

        // // 扩展获取当前鼠标移动的位置
        // handler.setInputAction(function (movement) {
        //     // console.log(viewer.scene, movement.endPosition, null)

        //     // 获取当前坐标
        //     console.log(latlng.getCurrentMousePosition(viewer.scene, movement.endPosition, null))

        //     // 获取当前坐标并转换为经纬度
        //     console.log(latlng.Cartesian3To(latlng.getCurrentMousePosition(viewer.scene, movement.endPosition, null), viewer).latlng)
        // }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
    </script>
</body>

</html>